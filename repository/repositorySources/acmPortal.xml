<meta_metadata_repository name="acm_portal" package="ecologylab.semantics.generated.library.scholarlyPublication" default_user_agent_name="chrome_2">

	<meta_metadata name="acm_portal" type="scholarly_article" parser="xpath" user_agent_name="google_bot_2">

		<selector url_stripped="http://portal.acm.org/citation.cfm" />

		<url_generator type="search" engine="acm_portal" use_id="title" />

		<scalar name="location" xpath="//div[@id='divmain']//a[@name='FullTextPdf' or @name='FullTextPDF']/@href" />

<!-- 		<scalar name="title" xpath="//div[@class='large-text']" navigates_to="metadata_page" as_natural_id="title" format="text" /> -->

		<collection name="authors" xpath="//div[@id='divmain']//a[@title='Author Profile Page']">
			<scalar name="location" xpath="./@href" />
			<scalar name="title" xpath="./text()" />
			<scalar name="affiliation" xpath="../..//a[@title='Institutional Profile Page']/text()" />
		</collection>

		<composite name="source" navigates_to="location" xpath="//h1/a/span[contains(text(), 'PUBLICATION')]/ancestor::h1/following-sibling::div[@class='flatbody'][1]">
			<scalar name="location" xpath=".//td[text()='Title']/following-sibling::td/a[1]" />
			<scalar name="archive_name" xpath=".//td[text()='Title']/following-sibling::td" />
			<scalar name="year_of_publication" xpath=".//td[text()='Publisher']/following-sibling::td" label="year published">
				<filter regex="[\D]" replace="" />
			</scalar>
			<scalar name="pages" xpath=".//td[text()='Pages']/following-sibling::td" />
		</composite>

		<scalar name="abstract_field" label="abstract" xpath="//h1/a[contains(text(), 'ABSTRACT')]/ancestor::h1/following-sibling::div[@class='flatbody'][1]" />

		<collection name="references" xpath="//h1/a/span[contains(text(), 'REFERENCES')]/ancestor::h1/following-sibling::div[@class='flatbody'][1]//tr//a[1]">
			<scalar name="location" xpath="./@href" />
			<scalar name="description" xpath="./child::text()" />
		</collection>

		<collection name="citations" xpath="//h1/a/span[contains(text(), 'CITED BY')]/ancestor::h1/following-sibling::div[@class='flatbody'][1]//tr//a[1]">
			<scalar name="location" xpath="./@href" />
			<scalar name="description" xpath="./child::text()" />
		</collection>

		<collection name="classifications" xpath="//h1/a/span[contains(text(), 'INDEX TERMS')]/ancestor::h1/following-sibling::div[@class='flatbody'][1]//a[not(@name)]">
			<scalar name="link" xpath="./@href" />
			<scalar name="tag_name" xpath="./child::text()" />
		</collection>

		<collection name="keywords" xpath="//div[@id='divtags']//a/span/ancestor::a">
			<scalar name="link" xpath="./@href" />
			<scalar name="tag_name" xpath="./span/child::text()" />
		</collection>

		<link_with name="citeseerx_summary" by_id="title" />
		<!-- <link_with name="google_scholar_search_result" by_id="title" /> -->

		<semantic_actions>
			<get_field name="location" />
			<set_field name="metadata_page" value="location" />
			<if>
				<not_null value="location" />
				<parse_document now="true">
					<arg name="document" value="metadata" />
					<arg name="location" value="location" />
				</parse_document>
			</if>

			<get_field name="title" />
			<create_and_visualize_text_surrogate>
				<arg value="title" name="text" />
			</create_and_visualize_text_surrogate>

			<!-- <get_linked_metadata name="citeseerx_summary" /> -->
			<!-- <get_linked_metadata name="google_scholar_search_result" /> -->

			<get_field name="references" />
			<if>
				<not_null value="references" />
				<for_each collection="references" as="ref">
					<get_field object="ref" name="description" />
					<parse_document link_type="TRUSTED_SEMANTICS">
						<arg name="ciatation_sig" value="true" />
						<arg name="anchor_text" value="description" />
						<arg name="entity" value="ref" />
					</parse_document>
				</for_each>
			</if>

			<get_field name="citations" />
			<if>
				<not_null value="citations" />
				<for_each collection="citations" as="cit">
					<get_field object="cit" name="location" />
					<get_field object="cit" name="description" />
					<parse_document link_type="TRUSTED_SEMANTICS">
						<arg name="citation_sig" value="true" />
						<arg name="anchor_text" value="description" />
						<arg name="entity" value="cit" />
					</parse_document>
				</for_each>
			</if>
		</semantic_actions>

	</meta_metadata>

<!--	<meta_metadata name="acm_proceeding" extends="compound_document" parser="xpath">-->
<!--		<selector url_stripped="http://portal.acm.org/toc.cfm" />-->
<!--		<collection name="proceedings" hide="true" xpath="//tr[@valign='top']/td[@class='small-text']/strong" child_type="search_result">-->
<!--			<scalar name="link" xpath="./a/@href" />-->
<!--			<scalar name="heading" xpath="./a/text()" />-->
<!--		</collection>-->
<!--		<collection name="papers" xpath="//div[@id='prox']/div/table/tr" child_type="search_result">-->
<!--			<scalar name="link" xpath=".//@href" />-->
<!--			<scalar name="heading" xpath=".//a" />-->
<!--		</collection>-->
<!--		<semantic_actions>-->
<!--			<get_field name="proceedings" />-->
<!--			<if>-->
<!--				<not_null value="proceedings" />-->
<!--				<for_each collection="proceedings" as="proceeding">-->
<!--					<get_field object="proceeding" name="link" />-->
<!--					<get_field object="proceeding" name="heading" />-->
<!--					<parse_document link_type="TRUSTED_SEMANTICS">-->
<!--						<arg value="heading" name="anchor_text" />-->
<!--						<arg value="link" name="location" />-->
<!--					</parse_document>-->
<!--				</for_each>-->
<!--			</if>-->
<!--			<get_field name="papers" />-->
<!--			<if>-->
<!--				<not_null value="papers" />-->
<!--				<for_each collection="papers" as="paper">-->
<!--					<get_field object="paper" name="link" />-->
<!--					<get_field object="paper" name="heading" />-->
<!--					<parse_document link_type="TRUSTED_SEMANTICS">-->
<!--						<arg value="heading" name="anchor_text" />-->
<!--						<arg value="link" name="location" />-->
<!--					</parse_document>-->
<!--				</for_each>-->
<!--			</if>-->
<!--		</semantic_actions>-->
<!--	</meta_metadata>-->

	<meta_metadata name="acm_portal_search_result" extends="search_result">
		<scalar name="author_list" scalar_type="String" />
		<scalar name="publication" scalar_type="String" />
	</meta_metadata>

	<meta_metadata name="acm_portal_search" extends="search" parser="xpath" user_agent_name="firefox_3_6_8">

		<selector url_stripped="http://portal.acm.org/results.cfm" />

		<collection name="search_results" child_type="acm_portal_search_result" xpath="//a[starts-with(@href, 'citation.cfm')]/../../..">
			<scalar name="heading" xpath="./tr[1]/td/a" />
			<scalar name="snippet" xpath="./tr[5]" />
			<scalar name="link" xpath="./tr[1]/td/a/@href" />
			<scalar name="author_list" xpath="./tr[1]/td/div" />
		</collection>

		<semantic_actions>
			<get_field name="search_results" />
			<if>
				<not_null value="search_results" />
				<for_each collection="search_results" as="result">
					<get_field object="result" name="heading" />
					<get_field object="result" name="link" />
					<parse_document link_type="TRUSTED_SEMANTICS">
						<arg name="anchor_text" value="heading" />
						<arg name="location" value="link" />
					</parse_document>
				</for_each>
			</if>
		</semantic_actions>

	</meta_metadata>

</meta_metadata_repository>