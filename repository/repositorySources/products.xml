<meta_metadata_repository name="products" package="ecologylab.semantics.generated.library.products">

	<meta_metadata name="product" extends="compound_document" parser="xpath">
		<scalar name="location" hide="true" />

		<scalar name="price" scalar_type="String" />
		<scalar name="model" scalar_type="String" />
		<scalar name="image_url" scalar_type="ParsedURL" hide="true" />
		<scalar name="overall_rating" scalar_type="String" />

		<collection name="reviews" child_type="product_review" child_extends="metadata">
			<scalar name="rating" scalar_type="String" />
			<scalar name="content" scalar_type="String" />
		</collection>
	</meta_metadata>

	<meta_metadata name="amazon_product" extends="product" parser="xpath" user_agent_name="firefox_3_6_8">
		<selector url_regex="http://www.amazon.com/[^/]*/dp/[^/]*" domain="amazon.com" />
		<selector url_regex="http://www.amazon.com/gp/product/[^/]*" domain="amazon.com" />

		<scalar name="department" scalar_type="String" xpath="//div[@id='navbar']//table[@id='navCatSubnav']//a[@class='navCatA']" />
		<scalar name="price" xpath="//b[@class='priceLarge']" />
		<scalar name="title" xpath="//span[@id='btAsinTitle']" />
		<scalar name="image_url" xpath="//td[@id='prodImageCell']//img/@src" />
		<scalar name="overall_rating" xpath="//span[@class='asinReviewsSummary']//span[1]/@title" />

		<collection name="reviews" xpath="//div[@class='content']/table/tr[2]/td[1]/div[position() &lt; last()-1]">
			<scalar name="rating" xpath="./div[2]/span/span[1]/@title" />
			<scalar name="content" xpath="." /> <!-- not concise! -->
		</collection>
		
		<semantic_actions>
			<reselect_meta_metadata_and_extract name="amazon_item" />
			<if>
				<not_null value="amazon_item" />
				<add_mixin object="amazon_item" mixin="metadata"/>
			</if>
		</semantic_actions>
	</meta_metadata>

</meta_metadata_repository>
