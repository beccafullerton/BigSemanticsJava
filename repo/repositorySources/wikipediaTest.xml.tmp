<meta_metadata_repository name="wikipedia" package="ecologylab.semantics.generated.library" default_user_agent_name="chrome_2">
	<meta_metadata name="wikipedia_search" comment="Wikipedia Web Search Class" type="search" user_agent_name="firefox_2" parser="xpath">
		<selector url_stripped="http://en.wikipedia.org/w/index.php?title=Special%3ASearch"/>
		<collection name="search_results" xpath="//div[@id='bodyContent']/div[@class='searchresults']/ul[@class='mw-search-results']/li">
			<scalar name="heading" xpath="./a" />
			<scalar name="link" xpath="./a/@href" />
			<scalar name="snippet" xpath="./div[@class='searchresult']" />
		</collection>
		<semantic_actions>
			<get_field name="search_results" />
			<for_each collection="search_results" as="res">
				<get_field object="res" name="link" />
				<parse_document_now>
					<arg value="link" name="container_link" />
				</parse_document_now>
			</for_each>
		</semantic_actions>
	</meta_metadata>
	
	<meta_metadata name="wikipedia_page_type" extends="document" comment="An article on wikipedia" package="ecologylab.semantics.generated.library">
		<collection name="paragraphs" comment="Paragraphs in the article." child_type="paragraph">
			<scalar name="paragraph_text" scalar_type="String" />
			<collection name="anchors" comment="Anchors (links) in the paragraph, typically links to another Wikipedia article." child_type="anchor">
				<scalar name="link" scalar_type="ParsedURL" />
				<scalar name="anchor_text" scalar_type="String" />
			</collection>
		</collection>
		<collection name="categories" comment="Wikipedia Categories" child_type="category">
			<scalar name="name" scalar_type="String" navigates_to="cat_link"/>
			<scalar name="cat_link" hide="true" scalar_type="ParsedURL" />
		</collection>
		<collection name="thumbinners" hide="true" child_type="thumbinner">
			<scalar name="thumb_img_src" scalar_type="ParsedURL" />
			<scalar name="thumb_img_caption" scalar_type="String" />
		</collection>
	</meta_metadata>
	
	<meta_metadata name="wikipedia_page" extends="wikipedia_page_type" comment="An article on wikipedia (used in cF)" package="ecologylab.semantics.generated.library" parser="xpath">
		<def_var name="main_image" xpath="//*[starts-with(@class,'infobox')]//img[1]" type="node" />
		<selector url_path_tree="http://en.wikipedia.org/wiki/"/>
		<scalar name="title" xpath="//h1[@id='firstHeading']" />
		<scalar name="description" xpath="//div[@class='bodycontent' and 1]/p[1]" />
		<scalar name="main_image_src" hide="true" xpath="./@src" context_node="main_image" scalar_type="ParsedURL" />
		<collection name="paragraphs" hide="true" xpath="//div[@id='bodyContent']/p/a[starts-with(@href,'/wiki/')]/.." child_type="paragraph">
			<scalar name="paragraph_text" xpath="string(.)" />
			<collection name="anchors" xpath="./a[starts-with(@href,'/wiki/')]" child_type="anchor">
				<scalar name="link" xpath="./@href" />
				<scalar name="anchor_text" xpath="string(.)" />
			</collection>
		</collection>
		<collection name="categories" xpath="//div[@id='mw-normal-catlinks']//a[starts-with(@href,'/wiki/Category:')]" child_type="category">
			<scalar name="name" xpath="string(.)"  />
			<scalar name="cat_link" xpath="./@href" />
		</collection>
		<collection name="thumbinners" xpath="//div[@class='thumbinner']" child_type="thumbinner">
			<scalar name="thumb_img_src" xpath="./a/img/@src" />
			<scalar name="thumb_img_caption" xpath="string(.)" />
		</collection>
		<semantic_actions>
			<get_field name="main_image_src" />
			<if>
				<not_null value="main_image_src" />
				<create_and_visualize_img_surrogate>
					<arg value="main_image_src" name="image_purl" />
				</create_and_visualize_img_surrogate>
			</if>
			<get_field name="paragraphs" />
			<for_each collection="paragraphs" as="para">
				<get_field object="para" name="paragraph_text" />
				<get_field object="para" name="anchors" />
				<for_each collection="anchors" as="anch">
					<get_field object="anch" name="link" />
					<get_field object="anch" name="anchor_text" />
					<if>
						<not_null value="anchor_text" />
						<not_null value="link" />
						<parse_document_later>
							<arg value="anchor_text" name="anchor_text" />
							<arg value="paragraph_text" name="anchor_context" />
							<arg value="link" name="container_link" />
						</parse_document_later>
					</if>
				</for_each>
				<create_and_visualize_text_surrogate>
					<arg value="paragraph_text" name="text" />
				</create_and_visualize_text_surrogate>
			</for_each>
			<get_field name="thumbinners" />
			<for_each collection="thumbinners" as="thumbinner">
				<get_field object="thumbinner" name="thumb_img_src" />
				<get_field object="thumbinner" name="thumb_img_caption" />
				<if>
					<not_null value="thumb_img_src" />
					<not_null value="thumb_img_caption" />
					<create_and_visualize_img_surrogate>
						<arg value="thumb_img_caption" name="caption" />
						<arg value="thumb_img_src" name="image_purl" />
					</create_and_visualize_img_surrogate>
				</if>
			</for_each>
		</semantic_actions>
	</meta_metadata>
</meta_metadata_repository>